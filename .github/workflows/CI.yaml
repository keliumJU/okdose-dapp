name: OKDOSE dApp - CI

on:
  pull_request:
    types: ["opened", "synchronize"]

jobs:
  build-tests:
    name: Run tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: "16"

      - name: 'create env file'
        env: 
          MAIN_ACCOUNT: ${{ secrets.MAINACCOUNT }}
          CONTRACT_METHOD : ${{ secrets.CONTRACT_METHOD }}
        run: |
          echo $MAIN_ACCOUNT
          echo $CONTRACT_METHOD
          touch .env
          echo MAIN_ACCOUNT='${{ secrets.MAINACCOUNT }}' >> .env
          echo CONTRACT_METHOD='${{ secrets.CONTRACT_METHOD }}' >> .env
          echo NMETIL_CONTRACT='${{ secrets.NMETIL_CONTRACT }}' >> .env
          echo NMETIL_BLOCK_ID='${{ secrets.NMETIL_BLOCK_ID }}' >> .env
          cat .env
          ls -a

      - name: 'Create .env file with action'
        uses: ozaytsev86/create-env-file@v1
        with:
          ENV_MAIN_ACCOUNT: ${{ secrets.MAINACCOUNT }}
          ENV_CONTRACT_METHOD: ${{ secrets.CONTRACT_METHOD }}
          ENV_NMETIL_CONTRACT: ${{ secrets.NMETIL_CONTRACT }}
          ENV_NMETIL_BLOCK_ID: ${{ secrets.NMETIL_BLOCK_ID }}

      - name: "Install the project"
        run: yarn

      - name: "Build project"
        run: yarn build

      - name: "Run the tests"
        run: yarn test

      - name: "Run linter"
        run: yarn lint
